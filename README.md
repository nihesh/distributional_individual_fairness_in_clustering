Distributional Individual Fairness in Clustering
================================================

This is the codebase for our paper **Distributional Individual Fairness in Clustering**

Overview
--------

At a granular level, our implementation has 3 components:

| Component | Description | Point of Entry |
| --------- | ----------- | -------------- |
| Data Preparation | Processes raw csv data and generates .pkl file | data/data_preparation.py |
| Algorithm Execution | Reads the data from .pkl file and dumps the algorithm's output into Simulation_Dump | kmeans.py<br> gf.py<br> alg_if.py<br> opt_if.py<br> alg_cf.py<br> opt_cf.py |
| Inference Generation | Reads the dump generated by algorithms and generates inferences | inference.py |

Dependencies
------------

* pyemd-0.5.1 
* sklearn-0.21.3
* numpy-1.17.2
* matplotlib-3.0.2
* cplex-12.10.0.0

Test Script
-----------

To generate the plots reported in the paper, execute the following command:

> `python3 inference.py`

Plots and simulation output can be viewed in  `./Inferences` folder.

Data Preparation
----------------

> `$ cd data`

> `$ python3 data_preparation.py`

The script arguments can be modified within `data_preparation.py`. The following arguments can be tuned:

| Argument | Functionality |
| -------- | ------------- |
| type | Specifies the name of the dataset - this is the name in which the .pkl file will be generated |
| protected_groups | List of strings containing the attribute names of protected attributes as mentioned in raw csv |
| fields_of_interest | List of strings containing the attributes names to be considered for clustering as mentioned in raw csv |
| delimiter | Delimiter that separates the attributes in csv |
| input_file | Path to the raw dataset |
| output_folder | The folder in which generated .pkl files should be dumped |
| max_samples | Number of points to be sampled from the csv uniformly at random, for a single trial |
| num_trials | Generates num_trials many independent subsamples of the dataset for averaging the results in the next phase |
| random_state | Seed value of random number generator |
| normalise | normalises the attributes to zero mean and unit variance, if set to true |

This implementation is generic and it can directly be used for any new dataset. The repository contains the generated `.pkl` files for bank, adult, creditcard, census1990 and diabetes datasets using the existing parameters.

Algorithm Execution
-------------------

This repository provides implementation for 6 different algorithms 
	
> `python3 <file>.py`

| Algorithm | File | Abbreviation |
| --------- | ---- | ------------ | 
| Soft K-Means | kmeans.py | SKM |
| Group Fairness | gf.py | GF |
| Individual Fairness | alg_if.py | ALG-IF | 
| Opt Individual Fairness | opt_if.py | OPT-IF |
| Combined Fairness | alg_cf.py | ALG-CF |
| Opt Combined Fairness | opt_cf.py | OPT-CF |

All the algorithms have almost the same set of tunable parameters. Note that the dataset size used for all the algorithms have to be consistent across all the non OPT algorithms for inference script (next phase) to work. Since OPT-IF and OPT-CF are run on smaller datasets of size 80, ALG-IF and ALG-CF must be run on the same set so that the inference script can draw a comparison.

| Argument | Functionality | Values |
| -------- | ------------- | ------ |
| dataset | Name of the dataset to be used - expects <dataset>.pkl file to be present from previous phase | bank<br> adult<br> creditcard<br> census1990<br> diabetes |
| num_clusters | List of cluster sizes over which the algorithm must be executed | List |
| num_samples | The number of points over which the algorithm has to be trained - limited by the number of points in the .pkl file | Integer |
| num_files | Number of different pickle files over which the results should be averaged - limited by the number of subsamples of the dataset in ./processed/<dataset> | Integer |
| quiet | Prints simulation results to stdout when set to false | Boolean |
| num_nearest_neighbours | Number of nearest neighbours to consider for individual fairness | Integer |
| temperature | Softmax temperature or stiffness parameter - exclusive to softmax | Float |
| delta | Measure of tightness of group fairness constraints introduced by Bera et. al. | Float |
| fairness_type | Type of fairness similarity metric to be used | Integer |

Inference Generation
--------------------

> `python3 inference.py`

`inference.py` generates plots that compare or highlight the performance of different algorithms and stores it in `./Inferences`. It also stores the cost incurred by various algorithms on each dataset and each cluster size. 

| Argument | Functionality | Values |
| -------- | ------------- | ------ |
| alg_dataset_size | Size of the dataset on which non OPT algorithms were run in the previous phase | Integer |
| opt_dataset_size | Size of the dataset on which OPT algorithms were run in the previous phase | Integer |
| dataset | List of datasets to be compared | List |